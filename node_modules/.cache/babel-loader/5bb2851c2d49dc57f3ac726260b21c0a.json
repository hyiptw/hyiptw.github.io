{"ast":null,"code":"import _regeneratorRuntime from\"/home/fs/srmswap/srmswap/srmswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/fs/srmswap/srmswap/srmswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/fs/srmswap/srmswap/srmswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useMemo,useState}from\"react\";import{Card}from\"antd\";import{getTokenName,formatTokenAmount,convert,STABLE_COINS}from\"../../utils/utils\";import{PieChart,Pie,Cell}from\"recharts\";import{useMint,useAccount}from\"../../utils/accounts\";import{ENDPOINTS,useConnection,useConnectionConfig}from\"../../utils/connection\";import{MARKETS,TOKEN_MINTS,Market}from\"@project-serum/serum\";import{Connection}from\"@solana/web3.js\";var RADIAN=Math.PI/180;var renderCustomizedLabel=function renderCustomizedLabel(props,data){var cx=props.cx,cy=props.cy,midAngle=props.midAngle,innerRadius=props.innerRadius,outerRadius=props.outerRadius,index=props.index;var radius=innerRadius+(outerRadius-innerRadius)*0.5;var x=cx+radius*Math.cos(-midAngle*RADIAN);var y=cy+radius*Math.sin(-midAngle*RADIAN);return/*#__PURE__*/React.createElement(\"text\",{x:x,y:y,fill:\"#FFFFFF\",textAnchor:x>cx?\"start\":\"end\",dominantBaseline:\"central\"},data[index].name);};var useMidPriceInUSD=function useMidPriceInUSD(mint){var connection=useMemo(function(){return new Connection(ENDPOINTS[0].endpoint,\"recent\");},[]);var _useState=useState(undefined),_useState2=_slicedToArray(_useState,2),price=_useState2[0],setPrice=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isBase=_useState4[0],setIsBase=_useState4[1];useEffect(function(){setIsBase(true);setPrice(undefined);var SERUM_TOKEN=TOKEN_MINTS.find(function(a){return a.address.toBase58()===mint;});var marketName=\"\".concat(SERUM_TOKEN===null||SERUM_TOKEN===void 0?void 0:SERUM_TOKEN.name,\"/USDC\");var marketInfo=MARKETS.find(function(m){return m.name===marketName;});if(STABLE_COINS.has((SERUM_TOKEN===null||SERUM_TOKEN===void 0?void 0:SERUM_TOKEN.name)||\"\")){setIsBase(true);setPrice(1.0);return;}if(!(marketInfo===null||marketInfo===void 0?void 0:marketInfo.programId)){return;}_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var market,bids,asks,bestBid,bestAsk;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return Market.load(connection,marketInfo.address,undefined,marketInfo.programId);case 2:market=_context.sent;_context.next=5;return market.loadBids(connection);case 5:bids=_context.sent;_context.next=8;return market.loadAsks(connection);case 8:asks=_context.sent;bestBid=bids.getL2(1);bestAsk=asks.getL2(1);setIsBase(false);if(bestBid.length>0&&bestAsk.length>0){setPrice((bestBid[0][0]+bestAsk[0][0])/2.0);}case 13:case\"end\":return _context.stop();}}},_callee);}))();},[connection,mint,setIsBase,setPrice]);return{price:price,isBase:isBase};};export var SupplyOverview=function SupplyOverview(props){var mintAddress=props.mintAddress,pool=props.pool;var connection=useConnection();var mintA=useMint(mintAddress[0]);var mintB=useMint(mintAddress[1]);var accountA=useAccount((pool===null||pool===void 0?void 0:pool.pubkeys.holdingMints[0].toBase58())===mintAddress[0]?pool===null||pool===void 0?void 0:pool.pubkeys.holdingAccounts[0]:pool===null||pool===void 0?void 0:pool.pubkeys.holdingAccounts[1]);var accountB=useAccount((pool===null||pool===void 0?void 0:pool.pubkeys.holdingMints[0].toBase58())===mintAddress[0]?pool===null||pool===void 0?void 0:pool.pubkeys.holdingAccounts[1]:pool===null||pool===void 0?void 0:pool.pubkeys.holdingAccounts[0]);var _useConnectionConfig=useConnectionConfig(),env=_useConnectionConfig.env;var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),data=_useState6[0],setData=_useState6[1];var _useMidPriceInUSD=useMidPriceInUSD(mintAddress[0]),priceA=_useMidPriceInUSD.price,isBaseA=_useMidPriceInUSD.isBase;var _useMidPriceInUSD2=useMidPriceInUSD(mintAddress[1]),priceB=_useMidPriceInUSD2.price,isBaseB=_useMidPriceInUSD2.isBase;var hasBothPrices=priceA!==undefined&&priceB!==undefined;useEffect(function(){if(!mintAddress||!accountA||!accountB){return;}_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var chart;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:chart=[{name:getTokenName(env,mintAddress[0]),value:convert(accountA,mintA,hasBothPrices?priceA:undefined),color:\"#6610f2\"},{name:getTokenName(env,mintAddress[1]),value:convert(accountB,mintB,hasBothPrices?priceB:undefined),color:\"#d83aeb\"}];setData(chart);case 2:case\"end\":return _context2.stop();}}},_callee2);}))();},[accountA,accountB,mintA,mintB,connection,env,mintAddress,hasBothPrices,priceA,priceB]);if(!pool||!accountA||!accountB||data.length<1){return null;}return/*#__PURE__*/React.createElement(Card,{style:{borderWidth:0}},/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\"}},/*#__PURE__*/React.createElement(PieChart,{width:150,height:150},/*#__PURE__*/React.createElement(Pie,{dataKey:\"value\",isAnimationActive:false,data:data,labelLine:false,cx:70,cy:70,label:function label(props){return renderCustomizedLabel(props,data);},outerRadius:60},data.map(function(entry,index){return/*#__PURE__*/React.createElement(Cell,{key:\"cell-\".concat(index),stroke:\"\",fill:entry.color});}))),/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\",flexDirection:\"column\",marginLeft:20,flex:\"1 1\",alignItems:\"flex-start\",justifyContent:\"center\"}},/*#__PURE__*/React.createElement(\"div\",{title:formatTokenAmount(accountA,mintA)},/*#__PURE__*/React.createElement(\"span\",null,data[0].name,\":\"),\" \",formatTokenAmount(accountA,mintA,1,\"\",\"\",isBaseA?0:2,isBaseA),\" \",!isBaseA&&formatTokenAmount(accountA,mintA,priceA,\"($\",\")\",0,true)),/*#__PURE__*/React.createElement(\"div\",{title:formatTokenAmount(accountB,mintB)},/*#__PURE__*/React.createElement(\"span\",null,data[1].name,\":\"),\" \",formatTokenAmount(accountB,mintB,1,\"\",\"\",isBaseB?0:2,isBaseB),\" \",!isBaseB&&priceB&&formatTokenAmount(accountB,mintB,priceB,\"($\",\")\",0,true)))));};","map":{"version":3,"sources":["/home/fs/srmswap/srmswap/srmswap.github.io/src/components/pool/supplyOverview.tsx"],"names":["React","useEffect","useMemo","useState","Card","getTokenName","formatTokenAmount","convert","STABLE_COINS","PieChart","Pie","Cell","useMint","useAccount","ENDPOINTS","useConnection","useConnectionConfig","MARKETS","TOKEN_MINTS","Market","Connection","RADIAN","Math","PI","renderCustomizedLabel","props","data","cx","cy","midAngle","innerRadius","outerRadius","index","radius","x","cos","y","sin","name","useMidPriceInUSD","mint","connection","endpoint","undefined","price","setPrice","isBase","setIsBase","SERUM_TOKEN","find","a","address","toBase58","marketName","marketInfo","m","has","programId","load","market","loadBids","bids","loadAsks","asks","bestBid","getL2","bestAsk","length","SupplyOverview","mintAddress","pool","mintA","mintB","accountA","pubkeys","holdingMints","holdingAccounts","accountB","env","setData","priceA","isBaseA","priceB","isBaseB","hasBothPrices","chart","value","color","borderWidth","display","map","entry","flexDirection","marginLeft","flex","alignItems","justifyContent"],"mappings":"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","sourcesContent":["import React, { useEffect, useMemo, useState } from \"react\";\nimport { Card } from \"antd\";\nimport {\n  getTokenName,\n  formatTokenAmount,\n  convert,\n  STABLE_COINS,\n} from \"../../utils/utils\";\nimport { PieChart, Pie, Cell } from \"recharts\";\nimport { useMint, useAccount } from \"../../utils/accounts\";\nimport {\n  ENDPOINTS,\n  useConnection,\n  useConnectionConfig,\n} from \"../../utils/connection\";\nimport { PoolInfo } from \"../../models\";\nimport { MARKETS, TOKEN_MINTS, Market } from \"@project-serum/serum\";\nimport { Connection } from \"@solana/web3.js\";\n\nconst RADIAN = Math.PI / 180;\nconst renderCustomizedLabel = (props: any, data: any) => {\n  const { cx, cy, midAngle, innerRadius, outerRadius, index } = props;\n  const radius = innerRadius + (outerRadius - innerRadius) * 0.5;\n  const x = cx + radius * Math.cos(-midAngle * RADIAN);\n  const y = cy + radius * Math.sin(-midAngle * RADIAN);\n\n  return (\n    <text\n      x={x}\n      y={y}\n      fill=\"#FFFFFF\"\n      textAnchor={x > cx ? \"start\" : \"end\"}\n      dominantBaseline=\"central\"\n    >\n      {data[index].name}\n    </text>\n  );\n};\n\nconst useMidPriceInUSD = (mint: string) => {\n  const connection = useMemo(\n    () => new Connection(ENDPOINTS[0].endpoint, \"recent\"),\n    []\n  );\n  const [price, setPrice] = useState<number | undefined>(undefined);\n  const [isBase, setIsBase] = useState(false);\n\n  useEffect(() => {\n    setIsBase(true);\n    setPrice(undefined);\n\n    const SERUM_TOKEN = TOKEN_MINTS.find((a) => a.address.toBase58() === mint);\n    const marketName = `${SERUM_TOKEN?.name}/USDC`;\n    const marketInfo = MARKETS.find((m) => m.name === marketName);\n\n    if (STABLE_COINS.has(SERUM_TOKEN?.name || \"\")) {\n      setIsBase(true);\n      setPrice(1.0);\n      return;\n    }\n\n    if (!marketInfo?.programId) {\n      return;\n    }\n\n    (async () => {\n      let market = await Market.load(\n        connection,\n        marketInfo.address,\n        undefined,\n        marketInfo.programId\n      );\n\n      const bids = await market.loadBids(connection);\n      const asks = await market.loadAsks(connection);\n      const bestBid = bids.getL2(1);\n      const bestAsk = asks.getL2(1);\n\n      setIsBase(false);\n\n      if (bestBid.length > 0 && bestAsk.length > 0) {\n        setPrice((bestBid[0][0] + bestAsk[0][0]) / 2.0);\n      }\n    })();\n  }, [connection, mint, setIsBase, setPrice]);\n\n  return { price, isBase };\n};\n\nexport const SupplyOverview = (props: {\n  mintAddress: string[];\n  pool?: PoolInfo;\n}) => {\n  const { mintAddress, pool } = props;\n  const connection = useConnection();\n  const mintA = useMint(mintAddress[0]);\n  const mintB = useMint(mintAddress[1]);\n  const accountA = useAccount(\n    pool?.pubkeys.holdingMints[0].toBase58() === mintAddress[0]\n      ? pool?.pubkeys.holdingAccounts[0]\n      : pool?.pubkeys.holdingAccounts[1]\n  );\n  const accountB = useAccount(\n    pool?.pubkeys.holdingMints[0].toBase58() === mintAddress[0]\n      ? pool?.pubkeys.holdingAccounts[1]\n      : pool?.pubkeys.holdingAccounts[0]\n  );\n  const { env } = useConnectionConfig();\n  const [data, setData] = useState<\n    { name: string; value: number; color: string }[]\n  >([]);\n  const { price: priceA, isBase: isBaseA } = useMidPriceInUSD(mintAddress[0]);\n  const { price: priceB, isBase: isBaseB } = useMidPriceInUSD(mintAddress[1]);\n\n  const hasBothPrices = priceA !== undefined && priceB !== undefined;\n\n  useEffect(() => {\n    if (!mintAddress || !accountA || !accountB) {\n      return;\n    }\n\n    (async () => {\n      let chart = [\n        {\n          name: getTokenName(env, mintAddress[0]),\n          value: convert(accountA, mintA, hasBothPrices ? priceA : undefined),\n          color: \"#6610f2\",\n        },\n        {\n          name: getTokenName(env, mintAddress[1]),\n          value: convert(accountB, mintB, hasBothPrices ? priceB : undefined),\n          color: \"#d83aeb\",\n        },\n      ];\n\n      setData(chart);\n    })();\n  }, [\n    accountA,\n    accountB,\n    mintA,\n    mintB,\n    connection,\n    env,\n    mintAddress,\n    hasBothPrices,\n    priceA,\n    priceB,\n  ]);\n\n  if (!pool || !accountA || !accountB || data.length < 1) {\n    return null;\n  }\n\n  return (\n    <Card style={{ borderWidth: 0 }}>\n      <div style={{ display: \"flex\" }}>\n        <PieChart width={150} height={150}>\n          <Pie\n            dataKey=\"value\"\n            isAnimationActive={false}\n            data={data}\n            labelLine={false}\n            cx={70}\n            cy={70}\n            label={(props) => renderCustomizedLabel(props, data)}\n            outerRadius={60}\n          >\n            {data.map((entry, index) => (\n              <Cell key={`cell-${index}`} stroke=\"\" fill={entry.color} />\n            ))}\n          </Pie>\n        </PieChart>\n        <div\n          style={{\n            display: \"flex\",\n            flexDirection: \"column\",\n            marginLeft: 20,\n            flex: \"1 1\",\n            alignItems: \"flex-start\",\n            justifyContent: \"center\",\n          }}\n        >\n          <div title={formatTokenAmount(accountA, mintA)}>\n            <span>{data[0].name}:</span>{\" \"}\n            {formatTokenAmount(\n              accountA,\n              mintA,\n              1,\n              \"\",\n              \"\",\n              isBaseA ? 0 : 2,\n              isBaseA\n            )}{\" \"}\n            {!isBaseA &&\n              formatTokenAmount(accountA, mintA, priceA, \"($\", \")\", 0, true)}\n          </div>\n          <div title={formatTokenAmount(accountB, mintB)}>\n            <span>{data[1].name}:</span>{\" \"}\n            {formatTokenAmount(\n              accountB,\n              mintB,\n              1,\n              \"\",\n              \"\",\n              isBaseB ? 0 : 2,\n              isBaseB\n            )}{\" \"}\n            {!isBaseB &&\n              priceB &&\n              formatTokenAmount(accountB, mintB, priceB, \"($\", \")\", 0, true)}\n          </div>\n        </div>\n      </div>\n    </Card>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}