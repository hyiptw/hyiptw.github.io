{"ast":null,"code":"import _regeneratorRuntime from\"/home/fs/srmswap/srmswap/srmswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/fs/srmswap/srmswap/srmswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/home/fs/srmswap/srmswap/srmswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/home/fs/srmswap/srmswap/srmswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/fs/srmswap/srmswap/srmswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useMemo,useRef,useState}from\"react\";import{Button,Popover,Table}from\"antd\";import{AppBar}from\"./../appBar\";import{cache,getMultipleAccounts,MintParser,useCachedPool}from\"../../utils/accounts\";import{convert,getPoolName,STABLE_COINS}from\"../../utils/utils\";import{useConnectionConfig}from\"../../utils/connection\";import{Settings}from\"../settings\";import{SettingOutlined}from\"@ant-design/icons\";import{PoolIcon}from\"../tokenIcon\";import{Market,MARKETS,Orderbook,TOKEN_MINTS}from\"@project-serum/serum\";import{Connection,PublicKey}from\"@solana/web3.js\";import\"./styles.less\";import echarts from\"echarts\";var FlashText=function FlashText(props){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),activeClass=_useState2[0],setActiveClass=_useState2[1];var _useState3=useState(props.val),_useState4=_slicedToArray(_useState3,1),value=_useState4[0];useEffect(function(){if(props.val!==value){setActiveClass(props.val>value?\"flash-positive\":\"flash-negative\");setTimeout(function(){return setActiveClass(\"\");},200);}},[props.text,props.val,value]);return/*#__PURE__*/React.createElement(\"span\",{className:activeClass},props.text);};var INITAL_LIQUIDITY_DATE=new Date(\"2020-10-27\");var REFRESH_INTERVAL=30000;var OrderBookParser=function OrderBookParser(id,acc){var decoded=Orderbook.LAYOUT.decode(acc.data);var details={pubkey:id,account:_objectSpread({},acc),info:decoded};return details;};var getMidPrice=function getMidPrice(marketAddress,mintAddress){var _cache$get,_cache$get2,_cache$get3,_cache$get4;var SERUM_TOKEN=TOKEN_MINTS.find(function(a){return a.address.toBase58()===mintAddress;});if(STABLE_COINS.has((SERUM_TOKEN===null||SERUM_TOKEN===void 0?void 0:SERUM_TOKEN.name)||\"\")){return 1.0;}var marketInfo=cache.get(marketAddress);if(!marketInfo){return 0.0;}var decodedMarket=marketInfo.info;var baseMintDecimals=((_cache$get=cache.get(decodedMarket.baseMint))===null||_cache$get===void 0?void 0:_cache$get.info.decimals)||0;var quoteMintDecimals=((_cache$get2=cache.get(decodedMarket.quoteMint))===null||_cache$get2===void 0?void 0:_cache$get2.info.decimals)||0;var market=new Market(decodedMarket,baseMintDecimals,quoteMintDecimals,undefined,decodedMarket.programId);var bids=(_cache$get3=cache.get(decodedMarket.bids))===null||_cache$get3===void 0?void 0:_cache$get3.info;var asks=(_cache$get4=cache.get(decodedMarket.asks))===null||_cache$get4===void 0?void 0:_cache$get4.info;var bidsBook=new Orderbook(market,bids.accountFlags,bids.slab);var asksBook=new Orderbook(market,asks.accountFlags,asks.slab);var bestBid=bidsBook.getL2(1);var bestAsk=asksBook.getL2(1);if(bestBid.length>0&&bestAsk.length>0){return(bestBid[0][0]+bestAsk[0][0])/2.0;}return 0;};var SRM_USDC_MARKET=new PublicKey(\"CDdR97S8y96v3To93aKvi3nCnjUrbuVSuumw8FLvbVeg\");var SRM_MINT=new PublicKey(\"SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt\");export var ChartsView=React.memo(function(){var _useConnectionConfig=useConnectionConfig(),env=_useConnectionConfig.env,endpoint=_useConnectionConfig.endpoint;var _useCachedPool=useCachedPool(),pools=_useCachedPool.pools;var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),dataSource=_useState6[0],setDataSource=_useState6[1];var _useState7=useState(function(){return{liquidity:0,volume:0,fees:0};}),_useState8=_slicedToArray(_useState7,2),totals=_useState8[0],setTotals=_useState8[1];var chartDiv=useRef(null);var echartsRef=useRef(null);var updateCounterRef=useRef(0);// separate connection for market updates\nvar connection=useMemo(function(){return new Connection(endpoint,\"recent\");},[endpoint]);useEffect(function(){if(chartDiv.current){echartsRef.current=echarts.init(chartDiv.current);}return function(){echartsRef.current.dispose();};},[]);// TODO: display user percent in the pool\n// const { ownedPools } = useOwnedPools();\n// TODO: create cache object with layout type, get, query, add\n// Updates total values\nuseEffect(function(){setTotals(dataSource.reduce(function(acc,item){acc.liquidity=acc.liquidity+item.liquidity;acc.volume=acc.volume+item.volume;acc.fees=acc.fees+item.fees;return acc;},{liquidity:0,volume:0,fees:0}));// update chart on data changes only every 5 ticks\nif(echartsRef.current&&updateCounterRef.current%5===0){echartsRef.current.setOption({series:[{name:\"Liquidity\",type:\"treemap\",visibleMin:300,label:{show:true,formatter:\"{b}\"},itemStyle:{normal:{borderColor:\"#000\"}},breadcrumb:{show:false},data:dataSource.map(function(row){return{value:row.liquidity,name:row.name,path:\"Liquidity/\".concat(row.name),data:row};})}]});}if(dataSource.length>0){updateCounterRef.current=updateCounterRef.current+1;}},[dataSource,echartsRef.current]);useEffect(function(){var reverseSerumMarketCache=new Map();var marketsCache=_toConsumableArray(new Set(pools.map(function(p){return p.pubkeys.holdingMints;}).flat()).values()).reduce(function(acc,key){var mintAddress=key.toBase58();var SERUM_TOKEN=TOKEN_MINTS.find(function(a){return a.address.toBase58()===mintAddress;});var marketName=\"\".concat(SERUM_TOKEN===null||SERUM_TOKEN===void 0?void 0:SERUM_TOKEN.name,\"/USDC\");var marketInfo=MARKETS.find(function(m){return m.name===marketName;});if(marketInfo){reverseSerumMarketCache.set(marketInfo.address.toBase58(),mintAddress);acc.set(mintAddress,{marketInfo:marketInfo});}return acc;},new Map());var timer=0;var toQuery=new Set();var accountsToObserve=new Set();var refreshAccounts=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(keys){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",getMultipleAccounts(connection,keys,\"single\").then(function(_ref2){var keys=_ref2.keys,array=_ref2.array;return array.map(function(item,index){var address=keys[index];return cache.add(new PublicKey(address),item);});}));case 1:case\"end\":return _context.stop();}}},_callee);}));return function refreshAccounts(_x){return _ref.apply(this,arguments);};}();var updateData=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var TODAY;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:TODAY=new Date();_context2.next=3;return refreshAccounts(_toConsumableArray(accountsToObserve.keys()));case 3:setDataSource(pools.filter(function(p){return p.pubkeys.holdingMints&&p.pubkeys.holdingMints.length>1;}).map(function(p,index){var _marketsCache$get,_marketsCache$get2;var mints=(p.pubkeys.holdingMints||[]).map(function(a){return a.toBase58();}).sort();var indexA=mints[0]===p.pubkeys.holdingMints[0].toBase58()?0:1;var indexB=indexA===0?1:0;var accountA=cache.getAccount(p.pubkeys.holdingAccounts[indexA]);var mintA=cache.getMint(mints[0]);var accountB=cache.getAccount(p.pubkeys.holdingAccounts[indexB]);var mintB=cache.getMint(mints[1]);var baseReserveUSD=getMidPrice(((_marketsCache$get=marketsCache.get(mints[0]))===null||_marketsCache$get===void 0?void 0:_marketsCache$get.marketInfo.address.toBase58())||\"\",mints[0])*convert(accountA,mintA);var quoteReserveUSD=getMidPrice(((_marketsCache$get2=marketsCache.get(mints[1]))===null||_marketsCache$get2===void 0?void 0:_marketsCache$get2.marketInfo.address.toBase58())||\"\",mints[1])*convert(accountB,mintB);var srmYield=0;if(mints[0]===SRM_MINT.toBase58()||mints[1]===SRM_MINT.toBase58()){var srmMid=getMidPrice(SRM_USDC_MARKET.toBase58(),SRM_MINT.toBase58());srmYield=100000*srmMid/(baseReserveUSD+quoteReserveUSD)*(365/30);}var poolMint=cache.getMint(p.pubkeys.mint);if(poolMint===null||poolMint===void 0?void 0:poolMint.supply.eqn(0)){return;}var volume=0;var fees=0;var apy=0;if(p.pubkeys.feeAccount){var feeAccount=cache.getAccount(p.pubkeys.feeAccount);if(poolMint&&feeAccount&&feeAccount.info.mint.toBase58()===p.pubkeys.mint.toBase58()){var feeBalance=feeAccount===null||feeAccount===void 0?void 0:feeAccount.info.amount.toNumber();var supply=poolMint===null||poolMint===void 0?void 0:poolMint.supply.toNumber();var ownedPct=feeBalance/supply;var poolOwnerFees=ownedPct*baseReserveUSD+ownedPct*quoteReserveUSD;volume=poolOwnerFees/0.0004;fees=volume*0.003;if(fees!==0){var baseVolume=ownedPct*baseReserveUSD/0.0004;var quoteVolume=ownedPct*quoteReserveUSD/0.0004;// Aproximation not true for all pools we need to fine a better way\nvar daysSinceInception=Math.floor((TODAY.getTime()-INITAL_LIQUIDITY_DATE.getTime())/(24*3600*1000));var apy0=srmYield+parseFloat(baseVolume/daysSinceInception*0.003*356)/baseReserveUSD;var apy1=srmYield+parseFloat(quoteVolume/daysSinceInception*0.003*356)/quoteReserveUSD;apy=Math.max(apy0,apy1);}}}var lpMint=cache.getMint(p.pubkeys.mint);var name=getPoolName(env,p);var link=\"#/?pair=\".concat(name.replace(\"/\",\"-\"));return{key:p.pubkeys.account.toBase58(),id:index,name:name,address:p.pubkeys.mint.toBase58(),link:link,mints:mints,liquidityA:convert(accountA,mintA),liquidityAinUsd:baseReserveUSD,liquidityB:convert(accountB,mintB),liquidityBinUsd:quoteReserveUSD,supply:lpMint&&((lpMint===null||lpMint===void 0?void 0:lpMint.supply.toNumber())/Math.pow(10,(lpMint===null||lpMint===void 0?void 0:lpMint.decimals)||0)).toFixed(9),fees:fees,liquidity:baseReserveUSD+quoteReserveUSD,volume:volume,apy:apy,raw:p};}).filter(function(p){return p;}));timer=window.setTimeout(function(){return updateData();},REFRESH_INTERVAL);case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function updateData(){return _ref3.apply(this,arguments);};}();var subs=[];var initalQuery=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var allMarkets;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:allMarkets=_toConsumableArray(marketsCache.values()).map(function(m){return m.marketInfo.address.toBase58();});_context3.next=3;return getMultipleAccounts(connection,// only query for markets that are not in cahce\nallMarkets.filter(function(a){return cache.get(a)===undefined;}),\"single\").then(function(_ref5){var keys=_ref5.keys,array=_ref5.array;return array.map(function(item,index){var marketAddress=keys[index];var mintAddress=reverseSerumMarketCache.get(marketAddress);if(mintAddress){var market=marketsCache.get(mintAddress);if(market){var programId=market.marketInfo.programId;var id=market.marketInfo.address;cache.add(id,item,function(id,acc){var decoded=Market.getLayout(programId).decode(acc.data);var details={pubkey:id,account:_objectSpread({},acc),info:decoded};cache.registerParser(details.info.baseMint,MintParser);cache.registerParser(details.info.quoteMint,MintParser);cache.registerParser(details.info.bids,OrderBookParser);cache.registerParser(details.info.asks,OrderBookParser);return details;});}}return item;});});case 3:allMarkets.forEach(function(m){var market=cache.get(m);if(!market){return;}var decoded=market;if(!cache.get(decoded.info.baseMint)){toQuery.add(decoded.info.baseMint.toBase58());}if(!cache.get(decoded.info.baseMint)){toQuery.add(decoded.info.quoteMint.toBase58());}toQuery.add(decoded.info.bids.toBase58());accountsToObserve.add(decoded.info.bids.toBase58());toQuery.add(decoded.info.asks.toBase58());accountsToObserve.add(decoded.info.asks.toBase58());});_context3.next=6;return refreshAccounts(_toConsumableArray(toQuery.keys()));case 6:// start update loop\nupdateData();case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function initalQuery(){return _ref4.apply(this,arguments);};}();initalQuery();return function(){window.clearTimeout(timer);};},[pools]);var formatUSD=new Intl.NumberFormat(\"en-US\",{style:\"currency\",currency:\"USD\"});var formatPct=new Intl.NumberFormat(\"en-US\",{style:\"percent\",minimumFractionDigits:2,maximumFractionDigits:2});var columns=[{title:\"Name\",dataIndex:\"name\",key:\"name\",render:function render(text,record){return{props:{style:{}},children:/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\"}},/*#__PURE__*/React.createElement(PoolIcon,{mintA:record.mints[0],mintB:record.mints[1]}),/*#__PURE__*/React.createElement(\"a\",{href:record.link,target:\"_blank\",rel:\"noopener noreferrer\"},text))};}},{title:\"Liquidity\",dataIndex:\"liquidity\",key:\"liquidity\",render:function render(text,record){return{props:{style:{textAlign:\"right\"}},children:/*#__PURE__*/React.createElement(FlashText,{text:formatUSD.format(record.liquidity),val:record.liquidity})};},sorter:function sorter(a,b){return a.liquidity-b.liquidity;},sortOrder:\"descend\"},{title:\"Supply\",dataIndex:\"supply\",key:\"supply\",render:function render(text,record){return{props:{style:{textAlign:\"right\"}},children:/*#__PURE__*/React.createElement(FlashText,{text:text,val:record.supply})};}},{title:\"Volume\",dataIndex:\"volume\",key:\"volume\",render:function render(text,record){return{props:{style:{textAlign:\"right\"}},children:/*#__PURE__*/React.createElement(FlashText,{text:formatUSD.format(record.volume),val:record.volume})};}},{title:\"Fees\",dataIndex:\"fees\",key:\"fees\",render:function render(text,record){return{props:{style:{textAlign:\"right\"}},children:/*#__PURE__*/React.createElement(FlashText,{text:formatUSD.format(record.fees),val:record.fees})};}},{title:\"APY\",dataIndex:\"apy\",key:\"apy\",render:function render(text,record){return{props:{style:{textAlign:\"right\"}},children:formatPct.format(record.apy)};}},{title:\"Address\",dataIndex:\"address\",key:\"address\",render:function render(text){return{props:{style:{fontFamily:\"monospace\"}},children:/*#__PURE__*/React.createElement(\"span\",null,text)};}}];return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(AppBar,{right:/*#__PURE__*/React.createElement(Popover,{placement:\"topRight\",title:\"Settings\",content:/*#__PURE__*/React.createElement(Settings,null),trigger:\"click\"},/*#__PURE__*/React.createElement(Button,{shape:\"circle\",size:\"large\",type:\"text\",icon:/*#__PURE__*/React.createElement(SettingOutlined,null)}))}),/*#__PURE__*/React.createElement(\"div\",{className:\"info-header\"},/*#__PURE__*/React.createElement(\"h1\",null,\"Liquidity: \",formatUSD.format(totals.liquidity)),/*#__PURE__*/React.createElement(\"h1\",null,\"Volume: \",formatUSD.format(totals.volume))),/*#__PURE__*/React.createElement(\"div\",{ref:chartDiv,style:{height:\"250px\",width:\"100%\"}}),/*#__PURE__*/React.createElement(Table,{dataSource:dataSource,columns:columns,size:\"small\",pagination:{pageSize:10}}));});","map":{"version":3,"sources":["/home/fs/srmswap/srmswap/srmswap.github.io/src/components/charts/index.tsx"],"names":["React","useEffect","useMemo","useRef","useState","Button","Popover","Table","AppBar","cache","getMultipleAccounts","MintParser","useCachedPool","convert","getPoolName","STABLE_COINS","useConnectionConfig","Settings","SettingOutlined","PoolIcon","Market","MARKETS","Orderbook","TOKEN_MINTS","Connection","PublicKey","echarts","FlashText","props","activeClass","setActiveClass","val","value","setTimeout","text","INITAL_LIQUIDITY_DATE","Date","REFRESH_INTERVAL","OrderBookParser","id","acc","decoded","LAYOUT","decode","data","details","pubkey","account","info","getMidPrice","marketAddress","mintAddress","SERUM_TOKEN","find","a","address","toBase58","has","name","marketInfo","get","decodedMarket","baseMintDecimals","baseMint","decimals","quoteMintDecimals","quoteMint","market","undefined","programId","bids","asks","bidsBook","accountFlags","slab","asksBook","bestBid","getL2","bestAsk","length","SRM_USDC_MARKET","SRM_MINT","ChartsView","memo","env","endpoint","pools","dataSource","setDataSource","liquidity","volume","fees","totals","setTotals","chartDiv","echartsRef","updateCounterRef","connection","current","init","dispose","reduce","item","setOption","series","type","visibleMin","label","show","formatter","itemStyle","normal","borderColor","breadcrumb","map","row","path","reverseSerumMarketCache","Map","marketsCache","Set","p","pubkeys","holdingMints","flat","values","key","marketName","m","set","timer","toQuery","accountsToObserve","refreshAccounts","keys","then","array","index","add","updateData","TODAY","filter","mints","sort","indexA","indexB","accountA","getAccount","holdingAccounts","mintA","getMint","accountB","mintB","baseReserveUSD","quoteReserveUSD","srmYield","srmMid","poolMint","mint","supply","eqn","apy","feeAccount","feeBalance","amount","toNumber","ownedPct","poolOwnerFees","baseVolume","quoteVolume","daysSinceInception","Math","floor","getTime","apy0","parseFloat","apy1","max","lpMint","link","replace","liquidityA","liquidityAinUsd","liquidityB","liquidityBinUsd","pow","toFixed","raw","window","subs","initalQuery","allMarkets","getLayout","registerParser","forEach","clearTimeout","formatUSD","Intl","NumberFormat","style","currency","formatPct","minimumFractionDigits","maximumFractionDigits","columns","title","dataIndex","render","record","children","display","textAlign","format","sorter","b","sortOrder","fontFamily","height","width","pageSize"],"mappings":"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","sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport { Button, Popover, Table } from \"antd\";\nimport { AppBar } from \"./../appBar\";\nimport {\n  cache,\n  getMultipleAccounts,\n  MintParser,\n  ParsedAccountBase,\n  useCachedPool,\n} from \"../../utils/accounts\";\nimport { convert, getPoolName, STABLE_COINS } from \"../../utils/utils\";\nimport { useConnectionConfig } from \"../../utils/connection\";\nimport { Settings } from \"../settings\";\nimport { SettingOutlined } from \"@ant-design/icons\";\nimport { PoolIcon } from \"../tokenIcon\";\nimport { Market, MARKETS, Orderbook, TOKEN_MINTS } from \"@project-serum/serum\";\nimport { AccountInfo, Connection, PublicKey } from \"@solana/web3.js\";\nimport \"./styles.less\";\nimport echarts from \"echarts\";\n\nconst FlashText = (props: { text: string; val: number }) => {\n  const [activeClass, setActiveClass] = useState(\"\");\n  const [value] = useState(props.val);\n  useEffect(() => {\n    if (props.val !== value) {\n      setActiveClass(props.val > value ? \"flash-positive\" : \"flash-negative\");\n\n      setTimeout(() => setActiveClass(\"\"), 200);\n    }\n  }, [props.text, props.val, value]);\n\n  return <span className={activeClass}>{props.text}</span>;\n};\n\nconst INITAL_LIQUIDITY_DATE = new Date(\"2020-10-27\");\nconst REFRESH_INTERVAL = 30_000;\n\nconst OrderBookParser = (id: PublicKey, acc: AccountInfo<Buffer>) => {\n  const decoded = Orderbook.LAYOUT.decode(acc.data);\n\n  const details = {\n    pubkey: id,\n    account: {\n      ...acc,\n    },\n    info: decoded,\n  } as ParsedAccountBase;\n\n  return details;\n};\n\nconst getMidPrice = (marketAddress: string, mintAddress: string) => {\n  const SERUM_TOKEN = TOKEN_MINTS.find(\n    (a) => a.address.toBase58() === mintAddress\n  );\n\n  if (STABLE_COINS.has(SERUM_TOKEN?.name || \"\")) {\n    return 1.0;\n  }\n\n  const marketInfo = cache.get(marketAddress);\n  if (!marketInfo) {\n    return 0.0;\n  }\n\n  const decodedMarket = marketInfo.info;\n  const baseMintDecimals =\n    cache.get(decodedMarket.baseMint)?.info.decimals || 0;\n  const quoteMintDecimals =\n    cache.get(decodedMarket.quoteMint)?.info.decimals || 0;\n\n  const market = new Market(\n    decodedMarket,\n    baseMintDecimals,\n    quoteMintDecimals,\n    undefined,\n    decodedMarket.programId\n  );\n\n  const bids = cache.get(decodedMarket.bids)?.info;\n  const asks = cache.get(decodedMarket.asks)?.info;\n\n  const bidsBook = new Orderbook(market, bids.accountFlags, bids.slab);\n  const asksBook = new Orderbook(market, asks.accountFlags, asks.slab);\n\n  const bestBid = bidsBook.getL2(1);\n  const bestAsk = asksBook.getL2(1);\n\n  if (bestBid.length > 0 && bestAsk.length > 0) {\n    return (bestBid[0][0] + bestAsk[0][0]) / 2.0;\n  }\n\n  return 0;\n};\n\ninterface SerumMarket {\n  marketInfo: {\n    address: PublicKey;\n    name: string;\n    programId: PublicKey;\n    deprecated: boolean;\n  };\n\n  // 1st query\n  marketAccount?: AccountInfo<Buffer>;\n\n  // 2nd query\n  mintBase?: AccountInfo<Buffer>;\n  mintQuote?: AccountInfo<Buffer>;\n  bidAccount?: AccountInfo<Buffer>;\n  askAccount?: AccountInfo<Buffer>;\n}\n\ninterface Totals {\n  liquidity: number;\n  volume: number;\n  fees: number;\n}\n\nconst SRM_USDC_MARKET = new PublicKey(\"CDdR97S8y96v3To93aKvi3nCnjUrbuVSuumw8FLvbVeg\");\nconst SRM_MINT = new PublicKey(\"SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt\");\n\nexport const ChartsView = React.memo(() => {\n  const { env, endpoint } = useConnectionConfig();\n  const { pools } = useCachedPool();\n  const [dataSource, setDataSource] = useState<any[]>([]);\n  const [totals, setTotals] = useState<Totals>(() => ({\n    liquidity: 0,\n    volume: 0,\n    fees: 0,\n  }));\n  const chartDiv = useRef<HTMLDivElement>(null);\n  const echartsRef = useRef<any>(null);\n  const updateCounterRef = useRef(0);\n  // separate connection for market updates\n  const connection = useMemo(() => new Connection(endpoint, \"recent\"), [\n    endpoint,\n  ]);\n\n  useEffect(() => {\n    if (chartDiv.current) {\n      echartsRef.current = echarts.init(chartDiv.current);\n    }\n\n    return () => {\n      echartsRef.current.dispose();\n    };\n  }, []);\n\n  // TODO: display user percent in the pool\n  // const { ownedPools } = useOwnedPools();\n\n  // TODO: create cache object with layout type, get, query, add\n\n  // Updates total values\n  useEffect(() => {\n    setTotals(\n      dataSource.reduce(\n        (acc, item) => {\n          acc.liquidity = acc.liquidity + item.liquidity;\n          acc.volume = acc.volume + item.volume;\n          acc.fees = acc.fees + item.fees;\n          return acc;\n        },\n        { liquidity: 0, volume: 0, fees: 0 } as Totals\n      )\n    );\n\n    // update chart on data changes only every 5 ticks\n    if (echartsRef.current && updateCounterRef.current % 5 === 0) {\n      echartsRef.current.setOption({\n        series: [\n          {\n            name: \"Liquidity\",\n            type: \"treemap\",\n            visibleMin: 300,\n            label: {\n              show: true,\n              formatter: \"{b}\",\n            },\n            itemStyle: {\n              normal: {\n                borderColor: \"#000\",\n              },\n            },\n            breadcrumb: {\n              show: false,\n            },\n            data: dataSource.map((row) => {\n              return {\n                value: row.liquidity,\n                name: row.name,\n                path: `Liquidity/${row.name}`,\n                data: row,\n              };\n            }),\n          },\n        ],\n      });\n    }\n\n    if (dataSource.length > 0) {\n      updateCounterRef.current = updateCounterRef.current + 1;\n    }\n  }, [dataSource, echartsRef.current]);\n\n  useEffect(() => {\n    const reverseSerumMarketCache = new Map<string, string>();\n    const marketsCache = [\n      ...new Set(pools.map((p) => p.pubkeys.holdingMints).flat()).values(),\n    ].reduce((acc, key) => {\n      const mintAddress = key.toBase58();\n\n      const SERUM_TOKEN = TOKEN_MINTS.find(\n        (a) => a.address.toBase58() === mintAddress\n      );\n      const marketName = `${SERUM_TOKEN?.name}/USDC`;\n      const marketInfo = MARKETS.find((m) => m.name === marketName);\n\n      if (marketInfo) {\n        reverseSerumMarketCache.set(marketInfo.address.toBase58(), mintAddress);\n\n        acc.set(mintAddress, {\n          marketInfo,\n        });\n      }\n\n      return acc;\n    }, new Map<string, SerumMarket>());\n\n    let timer = 0;\n\n    const toQuery = new Set<string>();\n    const accountsToObserve = new Set<string>();\n\n    const refreshAccounts = async (keys: string[]) => {\n      return getMultipleAccounts(connection, keys, \"single\").then(\n        ({ keys, array }) => {\n          return array.map((item, index) => {\n            const address = keys[index];\n            return cache.add(new PublicKey(address), item);\n          });\n        }\n      );\n    }\n\n    const updateData = async () => {\n      const TODAY = new Date();\n\n      await refreshAccounts([...accountsToObserve.keys()]);\n\n      setDataSource(\n        pools\n          .filter(\n            (p) => p.pubkeys.holdingMints && p.pubkeys.holdingMints.length > 1\n          )\n          .map((p, index) => {\n            const mints = (p.pubkeys.holdingMints || [])\n              .map((a) => a.toBase58())\n              .sort();\n            const indexA =\n              mints[0] === p.pubkeys.holdingMints[0].toBase58() ? 0 : 1;\n            const indexB = indexA === 0 ? 1 : 0;\n            const accountA = cache.getAccount(\n              p.pubkeys.holdingAccounts[indexA]\n            );\n            const mintA = cache.getMint(mints[0]);\n            const accountB = cache.getAccount(\n              p.pubkeys.holdingAccounts[indexB]\n            );\n            const mintB = cache.getMint(mints[1]);\n\n            const baseReserveUSD =\n              getMidPrice(\n                marketsCache.get(mints[0])?.marketInfo.address.toBase58() || \"\",\n                mints[0]\n              ) * convert(accountA, mintA);\n            const quoteReserveUSD =\n              getMidPrice(\n                marketsCache.get(mints[1])?.marketInfo.address.toBase58() || \"\",\n                mints[1]\n              ) * convert(accountB, mintB);\n\n            let srmYield = 0;\n            if (mints[0] === SRM_MINT.toBase58() || mints[1] === SRM_MINT.toBase58()) {\n              const srmMid = getMidPrice(SRM_USDC_MARKET.toBase58(), SRM_MINT.toBase58());\n              srmYield = ((100_000 * srmMid) / (baseReserveUSD + quoteReserveUSD)) * (365 / 30)\n            }\n\n            const poolMint = cache.getMint(p.pubkeys.mint);\n            if (poolMint?.supply.eqn(0)) {\n              return;\n            }\n\n            let volume = 0;\n            let fees = 0;\n            let apy = 0;\n            if (p.pubkeys.feeAccount) {\n              const feeAccount = cache.getAccount(p.pubkeys.feeAccount);\n\n              if (\n                poolMint &&\n                feeAccount &&\n                feeAccount.info.mint.toBase58() === p.pubkeys.mint.toBase58()\n              ) {\n                const feeBalance = feeAccount?.info.amount.toNumber();\n                const supply = poolMint?.supply.toNumber();\n\n                const ownedPct = feeBalance / supply;\n\n                const poolOwnerFees =\n                  ownedPct * baseReserveUSD + ownedPct * quoteReserveUSD;\n                volume = poolOwnerFees / 0.0004;\n                fees = volume * 0.003;\n\n                if (fees !== 0) {\n                  const baseVolume = (ownedPct * baseReserveUSD) / 0.0004;\n                  const quoteVolume = (ownedPct * quoteReserveUSD) / 0.0004;\n\n                  // Aproximation not true for all pools we need to fine a better way\n                  const daysSinceInception = Math.floor(\n                    (TODAY.getTime() - INITAL_LIQUIDITY_DATE.getTime()) /\n                    (24 * 3600 * 1000)\n                  );\n                  const apy0 =\n                    srmYield + parseFloat(\n                      ((baseVolume / daysSinceInception) * 0.003 * 356) as any\n                    ) / baseReserveUSD;\n                  const apy1 =\n                    srmYield + parseFloat(\n                      ((quoteVolume / daysSinceInception) * 0.003 * 356) as any\n                    ) / quoteReserveUSD;\n\n                  apy = Math.max(apy0, apy1);\n                }\n              }\n            }\n\n            const lpMint = cache.getMint(p.pubkeys.mint);\n\n            const name = getPoolName(env, p);\n            const link = `#/?pair=${name.replace(\"/\", \"-\")}`;\n\n            return {\n              key: p.pubkeys.account.toBase58(),\n              id: index,\n              name,\n              address: p.pubkeys.mint.toBase58(),\n              link,\n              mints,\n              liquidityA: convert(accountA, mintA),\n              liquidityAinUsd: baseReserveUSD,\n              liquidityB: convert(accountB, mintB),\n              liquidityBinUsd: quoteReserveUSD,\n              supply:\n                lpMint &&\n                (\n                  lpMint?.supply.toNumber() /\n                  Math.pow(10, lpMint?.decimals || 0)\n                ).toFixed(9),\n              fees,\n              liquidity: baseReserveUSD + quoteReserveUSD,\n              volume,\n              apy,\n              raw: p,\n            };\n          })\n          .filter((p) => p)\n      );\n\n      timer = window.setTimeout(() => updateData(), REFRESH_INTERVAL);\n    };\n    const subs: number[] = [];\n\n    const initalQuery = async () => {\n      const allMarkets = [...marketsCache.values()].map((m) =>\n        m.marketInfo.address.toBase58()\n      );\n\n      await getMultipleAccounts(\n        connection,\n        // only query for markets that are not in cahce\n        allMarkets.filter((a) => cache.get(a) === undefined),\n        \"single\"\n      ).then(({ keys, array }) => {\n        return array.map((item, index) => {\n          const marketAddress = keys[index];\n          const mintAddress = reverseSerumMarketCache.get(marketAddress);\n          if (mintAddress) {\n            const market = marketsCache.get(mintAddress);\n\n            if (market) {\n              const programId = market.marketInfo.programId;\n              const id = market.marketInfo.address;\n              cache.add(id, item, (id, acc) => {\n                const decoded = Market.getLayout(programId).decode(acc.data);\n\n                const details = {\n                  pubkey: id,\n                  account: {\n                    ...acc,\n                  },\n                  info: decoded,\n                } as ParsedAccountBase;\n\n                cache.registerParser(details.info.baseMint, MintParser);\n                cache.registerParser(details.info.quoteMint, MintParser);\n                cache.registerParser(details.info.bids, OrderBookParser);\n                cache.registerParser(details.info.asks, OrderBookParser);\n\n                return details;\n              });\n            }\n          }\n\n          return item;\n        });\n      });\n\n\n      allMarkets.forEach((m) => {\n        const market = cache.get(m);\n        if (!market) {\n          return;\n        }\n\n        const decoded = market;\n\n        if (!cache.get(decoded.info.baseMint)) {\n          toQuery.add(decoded.info.baseMint.toBase58());\n        }\n\n        if (!cache.get(decoded.info.baseMint)) {\n          toQuery.add(decoded.info.quoteMint.toBase58());\n        }\n\n        toQuery.add(decoded.info.bids.toBase58());\n        accountsToObserve.add(decoded.info.bids.toBase58());\n\n        toQuery.add(decoded.info.asks.toBase58());\n        accountsToObserve.add(decoded.info.asks.toBase58());\n      });\n\n      await refreshAccounts([...toQuery.keys()]);\n\n      // start update loop\n      updateData();\n    };\n\n    initalQuery();\n\n    return () => {\n      window.clearTimeout(timer);\n    };\n  }, [pools]);\n\n  const formatUSD = new Intl.NumberFormat(\"en-US\", {\n    style: \"currency\",\n    currency: \"USD\",\n  });\n  const formatPct = new Intl.NumberFormat(\"en-US\", {\n    style: \"percent\",\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  });\n\n  const columns = [\n    {\n      title: \"Name\",\n      dataIndex: \"name\",\n      key: \"name\",\n      render(text: string, record: any) {\n        return {\n          props: {\n            style: {},\n          },\n          children: (\n            <div style={{ display: \"flex\" }}>\n              <PoolIcon mintA={record.mints[0]} mintB={record.mints[1]} />\n              <a href={record.link} target=\"_blank\" rel=\"noopener noreferrer\">\n                {text}\n              </a>\n            </div>\n          ),\n        };\n      },\n    },\n    {\n      title: \"Liquidity\",\n      dataIndex: \"liquidity\",\n      key: \"liquidity\",\n      render(text: string, record: any) {\n        return {\n          props: {\n            style: { textAlign: \"right\" },\n          },\n          children: (\n            <FlashText\n              text={formatUSD.format(record.liquidity)}\n              val={record.liquidity}\n            />\n          ),\n        };\n      },\n      sorter: (a: any, b: any) => a.liquidity - b.liquidity,\n      sortOrder: \"descend\" as any,\n    },\n    {\n      title: \"Supply\",\n      dataIndex: \"supply\",\n      key: \"supply\",\n      render(text: string, record: any) {\n        return {\n          props: {\n            style: { textAlign: \"right\" },\n          },\n          children: <FlashText text={text} val={record.supply} />,\n        };\n      },\n    },\n    {\n      title: \"Volume\",\n      dataIndex: \"volume\",\n      key: \"volume\",\n      render(text: string, record: any) {\n        return {\n          props: {\n            style: { textAlign: \"right\" },\n          },\n          children: (\n            <FlashText\n              text={formatUSD.format(record.volume)}\n              val={record.volume}\n            />\n          ),\n        };\n      },\n    },\n    {\n      title: \"Fees\",\n      dataIndex: \"fees\",\n      key: \"fees\",\n      render(text: string, record: any) {\n        return {\n          props: {\n            style: { textAlign: \"right\" },\n          },\n          children: (\n            <FlashText text={formatUSD.format(record.fees)} val={record.fees} />\n          ),\n        };\n      },\n    },\n    {\n      title: \"APY\",\n      dataIndex: \"apy\",\n      key: \"apy\",\n      render(text: string, record: any) {\n        return {\n          props: {\n            style: { textAlign: \"right\" },\n          },\n          children: formatPct.format(record.apy),\n        };\n      },\n    },\n    {\n      title: \"Address\",\n      dataIndex: \"address\",\n      key: \"address\",\n      render(text: string) {\n        return {\n          props: {\n            style: { fontFamily: \"monospace\" } as React.CSSProperties,\n          },\n          children: <span>{text}</span>,\n        };\n      },\n    },\n  ];\n\n  return (\n    <>\n      <AppBar\n        right={\n          <Popover\n            placement=\"topRight\"\n            title=\"Settings\"\n            content={<Settings />}\n            trigger=\"click\"\n          >\n            <Button\n              shape=\"circle\"\n              size=\"large\"\n              type=\"text\"\n              icon={<SettingOutlined />}\n            />\n          </Popover>\n        }\n      />\n      <div className=\"info-header\">\n        <h1>Liquidity: {formatUSD.format(totals.liquidity)}</h1>\n        <h1>Volume: {formatUSD.format(totals.volume)}</h1>\n      </div>\n      <div ref={chartDiv} style={{ height: \"250px\", width: \"100%\" }} />\n      <Table\n        dataSource={dataSource}\n        columns={columns}\n        size=\"small\"\n        pagination={{ pageSize: 10 }}\n      />\n    </>\n  );\n});\n"]},"metadata":{},"sourceType":"module"}