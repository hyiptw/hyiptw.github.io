{"ast":null,"code":"import _regeneratorRuntime from\"/home/fs/srmswap/srmswap/srmswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/fs/srmswap/srmswap/srmswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/fs/srmswap/srmswap/srmswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Button,Spin}from\"antd\";import React,{useState}from\"react\";import{useConnection,useConnectionConfig,useSlippageConfig}from\"../../utils/connection\";import{useWallet}from\"../../utils/wallet\";import{CurrencyInput}from\"../currencyInput\";import{LoadingOutlined}from\"@ant-design/icons\";import{swap,usePoolForBasket}from\"../../utils/pools\";import{notify}from\"../../utils/notifications\";import{useCurrencyPairState}from\"../../utils/currencyPair\";import{generateActionLabel,POOL_NOT_AVAILABLE,SWAP_LABEL}from\"../labels\";import\"./trade.less\";import{getTokenName}from\"../../utils/utils\";var antIcon=/*#__PURE__*/React.createElement(LoadingOutlined,{style:{fontSize:24},spin:true});// TODO:\n// Compute price breakdown with/without fee\n// Show slippage\n// Show fee information\nexport var TradeEntry=function TradeEntry(){var _useWallet=useWallet(),wallet=_useWallet.wallet,connected=_useWallet.connected;var connection=useConnection();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),pendingTx=_useState2[0],setPendingTx=_useState2[1];var _useCurrencyPairState=useCurrencyPairState(),A=_useCurrencyPairState.A,B=_useCurrencyPairState.B,setLastTypedAccount=_useCurrencyPairState.setLastTypedAccount;var pool=usePoolForBasket([A===null||A===void 0?void 0:A.mintAddress,B===null||B===void 0?void 0:B.mintAddress]);var _useSlippageConfig=useSlippageConfig(),slippage=_useSlippageConfig.slippage;var _useConnectionConfig=useConnectionConfig(),env=_useConnectionConfig.env;var swapAccounts=function swapAccounts(){var tempMint=A.mintAddress;var tempAmount=A.amount;A.setMint(B.mintAddress);A.setAmount(B.amount);B.setMint(tempMint);B.setAmount(tempAmount);};var handleSwap=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var components;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(A.account&&B.mintAddress)){_context.next=14;break;}_context.prev=1;setPendingTx(true);components=[{account:A.account,mintAddress:A.mintAddress,amount:A.convertAmount()},{mintAddress:B.mintAddress,amount:B.convertAmount()}];_context.next=6;return swap(connection,wallet,components,slippage,pool);case 6:_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);notify({description:\"Please try again and approve transactions from your wallet\",message:\"Swap trade cancelled.\",type:\"error\"});case 11:_context.prev=11;setPendingTx(false);return _context.finish(11);case 14:case\"end\":return _context.stop();}}},_callee,null,[[1,8,11,14]]);}));return function handleSwap(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(CurrencyInput,{title:\"Input\",onInputChange:function onInputChange(val){if(A.amount!==val){setLastTypedAccount(A.mintAddress);}A.setAmount(val);},amount:A.amount,mint:A.mintAddress,onMintChange:function onMintChange(item){A.setMint(item);}}),/*#__PURE__*/React.createElement(Button,{type:\"primary\",className:\"swap-button\",onClick:swapAccounts},\"\\u21C5\"),/*#__PURE__*/React.createElement(CurrencyInput,{title:\"To (Estimate)\",onInputChange:function onInputChange(val){if(B.amount!==val){setLastTypedAccount(B.mintAddress);}B.setAmount(val);},amount:B.amount,mint:B.mintAddress,onMintChange:function onMintChange(item){B.setMint(item);}})),/*#__PURE__*/React.createElement(Button,{className:\"trade-button\",type:\"primary\",size:\"large\",onClick:connected?handleSwap:wallet.connect,style:{width:\"100%\"},disabled:connected&&(pendingTx||!A.account||!B.mintAddress||A.account===B.account||!A.sufficientBalance()||!pool)},generateActionLabel(!pool?POOL_NOT_AVAILABLE(getTokenName(env,A.mintAddress),getTokenName(env,B.mintAddress)):SWAP_LABEL,connected,env,A,B,true),pendingTx&&/*#__PURE__*/React.createElement(Spin,{indicator:antIcon,className:\"trade-spinner\"})));};","map":{"version":3,"sources":["/home/fs/srmswap/srmswap/srmswap.github.io/src/components/trade/index.tsx"],"names":["Button","Spin","React","useState","useConnection","useConnectionConfig","useSlippageConfig","useWallet","CurrencyInput","LoadingOutlined","swap","usePoolForBasket","notify","useCurrencyPairState","generateActionLabel","POOL_NOT_AVAILABLE","SWAP_LABEL","getTokenName","antIcon","fontSize","TradeEntry","wallet","connected","connection","pendingTx","setPendingTx","A","B","setLastTypedAccount","pool","mintAddress","slippage","env","swapAccounts","tempMint","tempAmount","amount","setMint","setAmount","handleSwap","account","components","convertAmount","description","message","type","val","item","connect","width","sufficientBalance"],"mappings":"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","sourcesContent":["import { Button, Spin } from \"antd\";\nimport React, { useState } from \"react\";\nimport {\n  useConnection,\n  useConnectionConfig,\n  useSlippageConfig,\n} from \"../../utils/connection\";\nimport { useWallet } from \"../../utils/wallet\";\nimport { CurrencyInput } from \"../currencyInput\";\nimport { LoadingOutlined } from \"@ant-design/icons\";\nimport { swap, usePoolForBasket } from \"../../utils/pools\";\nimport { notify } from \"../../utils/notifications\";\nimport { useCurrencyPairState } from \"../../utils/currencyPair\";\nimport { generateActionLabel, POOL_NOT_AVAILABLE, SWAP_LABEL } from \"../labels\";\nimport \"./trade.less\";\nimport { getTokenName } from \"../../utils/utils\";\n\nconst antIcon = <LoadingOutlined style={{ fontSize: 24 }} spin />;\n\n// TODO:\n// Compute price breakdown with/without fee\n// Show slippage\n// Show fee information\n\nexport const TradeEntry = () => {\n  const { wallet, connected } = useWallet();\n  const connection = useConnection();\n  const [pendingTx, setPendingTx] = useState(false);\n  const { A, B, setLastTypedAccount } = useCurrencyPairState();\n  const pool = usePoolForBasket([A?.mintAddress, B?.mintAddress]);\n  const { slippage } = useSlippageConfig();\n  const { env } = useConnectionConfig();\n\n  const swapAccounts = () => {\n    const tempMint = A.mintAddress;\n    const tempAmount = A.amount;\n    A.setMint(B.mintAddress);\n    A.setAmount(B.amount);\n    B.setMint(tempMint);\n    B.setAmount(tempAmount);\n  };\n\n  const handleSwap = async () => {\n    if (A.account && B.mintAddress) {\n      try {\n        setPendingTx(true);\n\n        const components = [\n          {\n            account: A.account,\n            mintAddress: A.mintAddress,\n            amount: A.convertAmount(),\n          },\n          {\n            mintAddress: B.mintAddress,\n            amount: B.convertAmount(),\n          },\n        ];\n\n        await swap(connection, wallet, components, slippage, pool);\n      } catch {\n        notify({\n          description:\n            \"Please try again and approve transactions from your wallet\",\n          message: \"Swap trade cancelled.\",\n          type: \"error\",\n        });\n      } finally {\n        setPendingTx(false);\n      }\n    }\n  };\n\n  return (\n    <>\n      <div>\n        <CurrencyInput\n          title=\"Input\"\n          onInputChange={(val: any) => {\n            if (A.amount !== val) {\n              setLastTypedAccount(A.mintAddress);\n            }\n\n            A.setAmount(val);\n          }}\n          amount={A.amount}\n          mint={A.mintAddress}\n          onMintChange={(item) => {\n            A.setMint(item);\n          }}\n        />\n        <Button type=\"primary\" className=\"swap-button\" onClick={swapAccounts}>\n          ⇅\n        </Button>\n        <CurrencyInput\n          title=\"To (Estimate)\"\n          onInputChange={(val: any) => {\n            if (B.amount !== val) {\n              setLastTypedAccount(B.mintAddress);\n            }\n\n            B.setAmount(val);\n          }}\n          amount={B.amount}\n          mint={B.mintAddress}\n          onMintChange={(item) => {\n            B.setMint(item);\n          }}\n        />\n      </div>\n      <Button\n        className=\"trade-button\"\n        type=\"primary\"\n        size=\"large\"\n        onClick={connected ? handleSwap : wallet.connect}\n        style={{ width: \"100%\" }}\n        disabled={\n          connected &&\n          (pendingTx ||\n            !A.account ||\n            !B.mintAddress ||\n            A.account === B.account ||\n            !A.sufficientBalance() ||\n            !pool)\n        }\n      >\n        {generateActionLabel(\n          !pool\n            ? POOL_NOT_AVAILABLE(\n                getTokenName(env, A.mintAddress),\n                getTokenName(env, B.mintAddress)\n              )\n            : SWAP_LABEL,\n          connected,\n          env,\n          A,\n          B,\n          true\n        )}\n        {pendingTx && <Spin indicator={antIcon} className=\"trade-spinner\" />}\n      </Button>\n    </>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}