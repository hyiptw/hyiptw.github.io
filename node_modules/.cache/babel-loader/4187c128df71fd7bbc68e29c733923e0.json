{"ast":null,"code":"import _regeneratorRuntime from\"/home/fs/srmswap/oyster-swap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/home/fs/srmswap/oyster-swap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"/home/fs/srmswap/oyster-swap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/fs/srmswap/oyster-swap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useLocalStorageState}from\"./utils\";import{Account,clusterApiUrl,Connection,Transaction}from\"@solana/web3.js\";import React,{useContext,useEffect,useMemo}from\"react\";import{setProgramIds}from\"./ids\";import{notify}from\"./notifications\";export var ENDPOINTS=[{name:\"mainnet-beta\",endpoint:\"https://solana-api.projectserum.com/\"},{name:\"testnet\",endpoint:clusterApiUrl(\"testnet\")},{name:\"devnet\",endpoint:clusterApiUrl(\"devnet\")},{name:\"localnet\",endpoint:\"http://127.0.0.1:8899\"}];var DEFAULT=ENDPOINTS[0].endpoint;var DEFAULT_SLIPPAGE=0.25;var ConnectionContext=React.createContext({endpoint:DEFAULT,setEndpoint:function setEndpoint(){},slippage:DEFAULT_SLIPPAGE,setSlippage:function setSlippage(val){},connection:new Connection(DEFAULT,\"recent\"),sendConnection:new Connection(DEFAULT,\"recent\"),env:ENDPOINTS[0].name});export function ConnectionProvider(_ref){var _ENDPOINTS$find;var _ref$children=_ref.children,children=_ref$children===void 0?undefined:_ref$children;var _useLocalStorageState=useLocalStorageState(\"connectionEndpts\",ENDPOINTS[0].endpoint),_useLocalStorageState2=_slicedToArray(_useLocalStorageState,2),endpoint=_useLocalStorageState2[0],setEndpoint=_useLocalStorageState2[1];var _useLocalStorageState3=useLocalStorageState(\"slippage\",DEFAULT_SLIPPAGE.toString()),_useLocalStorageState4=_slicedToArray(_useLocalStorageState3,2),slippage=_useLocalStorageState4[0],_setSlippage=_useLocalStorageState4[1];var connection=useMemo(function(){return new Connection(endpoint,\"recent\");},[endpoint]);var sendConnection=useMemo(function(){return new Connection(endpoint,\"recent\");},[endpoint]);var env=((_ENDPOINTS$find=ENDPOINTS.find(function(end){return end.endpoint===endpoint;}))===null||_ENDPOINTS$find===void 0?void 0:_ENDPOINTS$find.name)||ENDPOINTS[0].name;setProgramIds(env);// The websocket library solana/web3.js uses closes its websocket connection when the subscription list\n// is empty after opening its first time, preventing subsequent subscriptions from receiving responses.\n// This is a hack to prevent the list from every getting empty\nuseEffect(function(){var id=connection.onAccountChange(new Account().publicKey,function(){});return function(){connection.removeAccountChangeListener(id);};},[connection]);useEffect(function(){var id=connection.onSlotChange(function(){return null;});return function(){connection.removeSlotChangeListener(id);};},[connection]);useEffect(function(){var id=sendConnection.onAccountChange(new Account().publicKey,function(){});return function(){sendConnection.removeAccountChangeListener(id);};},[sendConnection]);useEffect(function(){var id=sendConnection.onSlotChange(function(){return null;});return function(){sendConnection.removeSlotChangeListener(id);};},[sendConnection]);return/*#__PURE__*/React.createElement(ConnectionContext.Provider,{value:{endpoint:endpoint,setEndpoint:setEndpoint,slippage:parseFloat(slippage),setSlippage:function setSlippage(val){return _setSlippage(val.toString());},connection:connection,sendConnection:sendConnection,env:env}},children);}export function useConnection(){return useContext(ConnectionContext).connection;}export function useSendConnection(){var _useContext;return(_useContext=useContext(ConnectionContext))===null||_useContext===void 0?void 0:_useContext.sendConnection;}export function useConnectionConfig(){var context=useContext(ConnectionContext);return{endpoint:context.endpoint,setEndpoint:context.setEndpoint,env:context.env};}export function useSlippageConfig(){var _useContext2=useContext(ConnectionContext),slippage=_useContext2.slippage,setSlippage=_useContext2.setSlippage;return{slippage:slippage,setSlippage:setSlippage};}export var sendTransaction=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(connection,wallet,instructions,signers){var _transaction;var awaitConfirmation,transaction,_transaction2,rawTransaction,options,txid,status,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:awaitConfirmation=_args.length>4&&_args[4]!==undefined?_args[4]:true;transaction=new Transaction();instructions.forEach(function(instruction){return transaction.add(instruction);});_context.next=5;return connection.getRecentBlockhash(\"max\");case 5:transaction.recentBlockhash=_context.sent.blockhash;(_transaction=transaction).setSigners.apply(_transaction,[// fee payied by the wallet owner\nwallet.publicKey].concat(_toConsumableArray(signers.map(function(s){return s.publicKey;}))));if(signers.length>0){(_transaction2=transaction).partialSign.apply(_transaction2,_toConsumableArray(signers));}_context.next=10;return wallet.signTransaction(transaction);case 10:transaction=_context.sent;rawTransaction=transaction.serialize();options={skipPreflight:true,commitment:\"singleGossip\"};_context.next=15;return connection.sendRawTransaction(rawTransaction,options);case 15:txid=_context.sent;if(!awaitConfirmation){_context.next=23;break;}_context.next=19;return connection.confirmTransaction(txid,options&&options.commitment);case 19:status=_context.sent.value;if(!status.err){_context.next=23;break;}// TODO: notify\nnotify({message:\"Transaction failed...\",description:\"\".concat(txid),type:\"error\"});throw new Error(\"Raw transaction \".concat(txid,\" failed (\").concat(JSON.stringify(status),\")\"));case 23:return _context.abrupt(\"return\",txid);case 24:case\"end\":return _context.stop();}}},_callee);}));return function sendTransaction(_x,_x2,_x3,_x4){return _ref2.apply(this,arguments);};}();","map":null,"metadata":{},"sourceType":"module"}