{"ast":null,"code":"import _regeneratorRuntime from\"/home/fs/srmswap/oyster-swap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/fs/srmswap/oyster-swap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/fs/srmswap/oyster-swap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useMemo,useState}from\"react\";import{Card}from\"antd\";import{getTokenName,formatTokenAmount,convert,STABLE_COINS}from\"../../utils/utils\";import{PieChart,Pie,Cell}from\"recharts\";import{useMint,useAccount}from\"../../utils/accounts\";import{ENDPOINTS,useConnection,useConnectionConfig}from\"../../utils/connection\";import{MARKETS,TOKEN_MINTS,Market}from\"@project-serum/serum\";import{Connection}from\"@solana/web3.js\";var RADIAN=Math.PI/180;var renderCustomizedLabel=function renderCustomizedLabel(props,data){var cx=props.cx,cy=props.cy,midAngle=props.midAngle,innerRadius=props.innerRadius,outerRadius=props.outerRadius,index=props.index;var radius=innerRadius+(outerRadius-innerRadius)*0.5;var x=cx+radius*Math.cos(-midAngle*RADIAN);var y=cy+radius*Math.sin(-midAngle*RADIAN);return/*#__PURE__*/React.createElement(\"text\",{x:x,y:y,fill:\"#FFFFFF\",textAnchor:x>cx?\"start\":\"end\",dominantBaseline:\"central\"},data[index].name);};var useMidPriceInUSD=function useMidPriceInUSD(mint){var connection=useMemo(function(){return new Connection(ENDPOINTS[0].endpoint,\"recent\");},[]);var _useState=useState(undefined),_useState2=_slicedToArray(_useState,2),price=_useState2[0],setPrice=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isBase=_useState4[0],setIsBase=_useState4[1];useEffect(function(){setIsBase(true);setPrice(undefined);var SERUM_TOKEN=TOKEN_MINTS.find(function(a){return a.address.toBase58()===mint;});var marketName=\"\".concat(SERUM_TOKEN===null||SERUM_TOKEN===void 0?void 0:SERUM_TOKEN.name,\"/USDC\");var marketInfo=MARKETS.find(function(m){return m.name===marketName;});if(STABLE_COINS.has((SERUM_TOKEN===null||SERUM_TOKEN===void 0?void 0:SERUM_TOKEN.name)||\"\")){setIsBase(true);setPrice(1.0);return;}if(!(marketInfo===null||marketInfo===void 0?void 0:marketInfo.programId)){return;}_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var market,bids,asks,bestBid,bestAsk;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return Market.load(connection,marketInfo.address,undefined,marketInfo.programId);case 2:market=_context.sent;_context.next=5;return market.loadBids(connection);case 5:bids=_context.sent;_context.next=8;return market.loadAsks(connection);case 8:asks=_context.sent;bestBid=bids.getL2(1);bestAsk=asks.getL2(1);setIsBase(false);if(bestBid.length>0&&bestAsk.length>0){setPrice((bestBid[0][0]+bestAsk[0][0])/2.0);}case 13:case\"end\":return _context.stop();}}},_callee);}))();},[connection,mint,setIsBase,setPrice]);return{price:price,isBase:isBase};};export var SupplyOverview=function SupplyOverview(props){var mintAddress=props.mintAddress,pool=props.pool;var connection=useConnection();var mintA=useMint(mintAddress[0]);var mintB=useMint(mintAddress[1]);var accountA=useAccount((pool===null||pool===void 0?void 0:pool.pubkeys.holdingMints[0].toBase58())===mintAddress[0]?pool===null||pool===void 0?void 0:pool.pubkeys.holdingAccounts[0]:pool===null||pool===void 0?void 0:pool.pubkeys.holdingAccounts[1]);var accountB=useAccount((pool===null||pool===void 0?void 0:pool.pubkeys.holdingMints[0].toBase58())===mintAddress[0]?pool===null||pool===void 0?void 0:pool.pubkeys.holdingAccounts[1]:pool===null||pool===void 0?void 0:pool.pubkeys.holdingAccounts[0]);var _useConnectionConfig=useConnectionConfig(),env=_useConnectionConfig.env;var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),data=_useState6[0],setData=_useState6[1];var _useMidPriceInUSD=useMidPriceInUSD(mintAddress[0]),priceA=_useMidPriceInUSD.price,isBaseA=_useMidPriceInUSD.isBase;var _useMidPriceInUSD2=useMidPriceInUSD(mintAddress[1]),priceB=_useMidPriceInUSD2.price,isBaseB=_useMidPriceInUSD2.isBase;var hasBothPrices=priceA!==undefined&&priceB!==undefined;useEffect(function(){if(!mintAddress||!accountA||!accountB){return;}_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var chart;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:chart=[{name:getTokenName(env,mintAddress[0]),value:convert(accountA,mintA,hasBothPrices?priceA:undefined),color:\"#6610f2\"},{name:getTokenName(env,mintAddress[1]),value:convert(accountB,mintB,hasBothPrices?priceB:undefined),color:\"#d83aeb\"}];setData(chart);case 2:case\"end\":return _context2.stop();}}},_callee2);}))();},[accountA,accountB,mintA,mintB,connection,env,mintAddress,hasBothPrices,priceA,priceB]);if(!pool||!accountA||!accountB||data.length<1){return null;}return/*#__PURE__*/React.createElement(Card,{style:{borderWidth:0}},/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\"}},/*#__PURE__*/React.createElement(PieChart,{width:150,height:150},/*#__PURE__*/React.createElement(Pie,{dataKey:\"value\",isAnimationActive:false,data:data,labelLine:false,cx:70,cy:70,label:function label(props){return renderCustomizedLabel(props,data);},outerRadius:60},data.map(function(entry,index){return/*#__PURE__*/React.createElement(Cell,{key:\"cell-\".concat(index),stroke:\"\",fill:entry.color});}))),/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\",flexDirection:\"column\",marginLeft:20,flex:\"1 1\",alignItems:\"flex-start\",justifyContent:\"center\"}},/*#__PURE__*/React.createElement(\"div\",{title:formatTokenAmount(accountA,mintA)},/*#__PURE__*/React.createElement(\"span\",null,data[0].name,\":\"),\" \",formatTokenAmount(accountA,mintA,1,\"\",\"\",isBaseA?0:2,isBaseA),\" \",!isBaseA&&formatTokenAmount(accountA,mintA,priceA,\"($\",\")\",0,true)),/*#__PURE__*/React.createElement(\"div\",{title:formatTokenAmount(accountB,mintB)},/*#__PURE__*/React.createElement(\"span\",null,data[1].name,\":\"),\" \",formatTokenAmount(accountB,mintB,1,\"\",\"\",isBaseB?0:2,isBaseB),\" \",!isBaseB&&priceB&&formatTokenAmount(accountB,mintB,priceB,\"($\",\")\",0,true)))));};","map":null,"metadata":{},"sourceType":"module"}