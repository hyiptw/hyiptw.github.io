{"ast":null,"code":"import _regeneratorRuntime from\"/home/fs/srmswap/oyster-swap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/fs/srmswap/oyster-swap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/fs/srmswap/oyster-swap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useContext,useEffect,useState}from\"react\";import{calculateDependentAmount,usePoolForBasket}from\"./pools\";import{useMint,useAccountByMint}from\"./accounts\";import{useConnection,useConnectionConfig}from\"./connection\";import{convert}from\"./utils\";import PopularTokens from\"../utils/token-list.json\";import{useHistory,useLocation}from\"react-router-dom\";var CurrencyPairContext=React.createContext(null);export function CurrencyPairProvider(_ref){var _ref$children=_ref.children,children=_ref$children===void 0?null:_ref$children;var connection=useConnection();var _useConnectionConfig=useConnectionConfig(),env=_useConnectionConfig.env;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),amountA=_useState2[0],setAmountA=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),amountB=_useState4[0],setAmountB=_useState4[1];var history=useHistory();var location=useLocation();var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),mintAddressA=_useState6[0],setMintAddressA=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),mintAddressB=_useState8[0],setMintAddressB=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),lastTypedAccount=_useState10[0],setLastTypedAccount=_useState10[1];var accountA=useAccountByMint(mintAddressA);var accountB=useAccountByMint(mintAddressB);var mintA=useMint(mintAddressA);var mintB=useMint(mintAddressB);var pool=usePoolForBasket([mintAddressA,mintAddressB]);// updates browser history on token changes\nuseEffect(function(){var _PopularTokens$env$fi,_PopularTokens$env$fi2;// set history\nvar base=(_PopularTokens$env$fi=PopularTokens[env].find(function(t){return t.mintAddress===mintAddressA;}))===null||_PopularTokens$env$fi===void 0?void 0:_PopularTokens$env$fi.tokenSymbol;var quote=(_PopularTokens$env$fi2=PopularTokens[env].find(function(t){return t.mintAddress===mintAddressB;}))===null||_PopularTokens$env$fi2===void 0?void 0:_PopularTokens$env$fi2.tokenSymbol;if(base&&quote){history.push({pathname:\"/\",search:\"?pair=\".concat(base,\"-\").concat(quote)});}else{if(mintAddressA&&mintAddressB){history.push({pathname:\"/\",search:\"\"});}else{history.push({});}}},[mintAddressA,mintAddressB]);// Updates tokens on location change\nuseEffect(function(){var _PopularTokens$env$fi3,_PopularTokens$env$fi4;if(!location.search&&mintAddressA&&mintAddressB){return;}var _getDefaultTokens=getDefaultTokens(env,location.search),defaultBase=_getDefaultTokens.defaultBase,defaultQuote=_getDefaultTokens.defaultQuote;setMintAddressA(((_PopularTokens$env$fi3=PopularTokens[env].find(function(t){return t.tokenSymbol===defaultBase;}))===null||_PopularTokens$env$fi3===void 0?void 0:_PopularTokens$env$fi3.mintAddress)||\"\");setMintAddressB(((_PopularTokens$env$fi4=PopularTokens[env].find(function(t){return t.tokenSymbol===defaultQuote;}))===null||_PopularTokens$env$fi4===void 0?void 0:_PopularTokens$env$fi4.mintAddress)||\"\");},[location,location.search,setMintAddressA,setMintAddressB]);var calculateDependent=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var setDependent,amount,independent,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(pool&&mintAddressA&&mintAddressB)){_context.next=6;break;}if(lastTypedAccount===mintAddressA){independent=mintAddressA;setDependent=setAmountB;amount=parseFloat(amountA);}else{independent=mintAddressB;setDependent=setAmountA;amount=parseFloat(amountB);}_context.next=4;return calculateDependentAmount(connection,independent,amount,pool);case 4:result=_context.sent;if(result!==undefined&&Number.isFinite(result)){setDependent(result.toFixed(2));}else{setDependent(\"\");}case 6:case\"end\":return _context.stop();}}},_callee);})),[pool,mintAddressA,mintAddressB,setAmountA,setAmountB,amountA,amountB,connection,lastTypedAccount]);useEffect(function(){calculateDependent();},[amountB,amountA,lastTypedAccount,calculateDependent]);var _convertAmount=function convertAmount(amount,mint){return parseFloat(amount)*Math.pow(10,(mint===null||mint===void 0?void 0:mint.decimals)||0);};return/*#__PURE__*/React.createElement(CurrencyPairContext.Provider,{value:{A:{mintAddress:mintAddressA,account:accountA,mint:mintA,amount:amountA,setAmount:setAmountA,setMint:setMintAddressA,convertAmount:function convertAmount(){return _convertAmount(amountA,mintA);},sufficientBalance:function sufficientBalance(){return accountA!==undefined&&convert(accountA,mintA)>=parseFloat(amountA);}},B:{mintAddress:mintAddressB,account:accountB,mint:mintB,amount:amountB,setAmount:setAmountB,setMint:setMintAddressB,convertAmount:function convertAmount(){return _convertAmount(amountB,mintB);},sufficientBalance:function sufficientBalance(){return accountB!==undefined&&convert(accountB,mintB)>=parseFloat(amountB);}},setLastTypedAccount:setLastTypedAccount}},children);}export var useCurrencyPairState=function useCurrencyPairState(){var context=useContext(CurrencyPairContext);return context;};function getDefaultTokens(env,search){var defaultBase=\"BTC\";var defaultQuote=\"USDT\";console.log(search);var nameToToken=PopularTokens[env].reduce(function(map,item){map.set(item.tokenSymbol,item);return map;},new Map());if(search){var urlParams=new URLSearchParams(search);var pair=urlParams.get(\"pair\");if(pair){var items=pair.split(\"-\");if(items.length>1){if(nameToToken.has(items[0])){defaultBase=items[0];}if(nameToToken.has(items[1])){defaultQuote=items[1];}}}}return{defaultBase:defaultBase,defaultQuote:defaultQuote};}","map":null,"metadata":{},"sourceType":"module"}