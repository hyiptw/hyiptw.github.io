{"ast":null,"code":"import _regeneratorRuntime from\"/home/fs/srmswap/srmswap/srmswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/home/fs/srmswap/srmswap/srmswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"/home/fs/srmswap/srmswap/srmswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/fs/srmswap/srmswap/srmswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useLocalStorageState}from\"./utils\";import{Account,clusterApiUrl,Connection,Transaction}from\"@solana/web3.js\";import React,{useContext,useEffect,useMemo}from\"react\";import{setProgramIds}from\"./ids\";import{notify}from\"./notifications\";export var ENDPOINTS=[{name:\"mainnet-beta\",endpoint:\"https://solana-api.projectserum.com/\"},{name:\"testnet\",endpoint:clusterApiUrl(\"testnet\")},{name:\"devnet\",endpoint:clusterApiUrl(\"devnet\")},{name:\"localnet\",endpoint:\"http://127.0.0.1:8899\"}];var DEFAULT=ENDPOINTS[0].endpoint;var DEFAULT_SLIPPAGE=0.25;var ConnectionContext=React.createContext({endpoint:DEFAULT,setEndpoint:function setEndpoint(){},slippage:DEFAULT_SLIPPAGE,setSlippage:function setSlippage(val){},connection:new Connection(DEFAULT,\"recent\"),sendConnection:new Connection(DEFAULT,\"recent\"),env:ENDPOINTS[0].name});export function ConnectionProvider(_ref){var _ENDPOINTS$find;var _ref$children=_ref.children,children=_ref$children===void 0?undefined:_ref$children;var _useLocalStorageState=useLocalStorageState(\"connectionEndpts\",ENDPOINTS[0].endpoint),_useLocalStorageState2=_slicedToArray(_useLocalStorageState,2),endpoint=_useLocalStorageState2[0],setEndpoint=_useLocalStorageState2[1];var _useLocalStorageState3=useLocalStorageState(\"slippage\",DEFAULT_SLIPPAGE.toString()),_useLocalStorageState4=_slicedToArray(_useLocalStorageState3,2),slippage=_useLocalStorageState4[0],_setSlippage=_useLocalStorageState4[1];var connection=useMemo(function(){return new Connection(endpoint,\"recent\");},[endpoint]);var sendConnection=useMemo(function(){return new Connection(endpoint,\"recent\");},[endpoint]);var env=((_ENDPOINTS$find=ENDPOINTS.find(function(end){return end.endpoint===endpoint;}))===null||_ENDPOINTS$find===void 0?void 0:_ENDPOINTS$find.name)||ENDPOINTS[0].name;setProgramIds(env);// The websocket library solana/web3.js uses closes its websocket connection when the subscription list\n// is empty after opening its first time, preventing subsequent subscriptions from receiving responses.\n// This is a hack to prevent the list from every getting empty\nuseEffect(function(){var id=connection.onAccountChange(new Account().publicKey,function(){});return function(){connection.removeAccountChangeListener(id);};},[connection]);useEffect(function(){var id=connection.onSlotChange(function(){return null;});return function(){connection.removeSlotChangeListener(id);};},[connection]);useEffect(function(){var id=sendConnection.onAccountChange(new Account().publicKey,function(){});return function(){sendConnection.removeAccountChangeListener(id);};},[sendConnection]);useEffect(function(){var id=sendConnection.onSlotChange(function(){return null;});return function(){sendConnection.removeSlotChangeListener(id);};},[sendConnection]);return/*#__PURE__*/React.createElement(ConnectionContext.Provider,{value:{endpoint:endpoint,setEndpoint:setEndpoint,slippage:parseFloat(slippage),setSlippage:function setSlippage(val){return _setSlippage(val.toString());},connection:connection,sendConnection:sendConnection,env:env}},children);}export function useConnection(){return useContext(ConnectionContext).connection;}export function useSendConnection(){var _useContext;return(_useContext=useContext(ConnectionContext))===null||_useContext===void 0?void 0:_useContext.sendConnection;}export function useConnectionConfig(){var context=useContext(ConnectionContext);return{endpoint:context.endpoint,setEndpoint:context.setEndpoint,env:context.env};}export function useSlippageConfig(){var _useContext2=useContext(ConnectionContext),slippage=_useContext2.slippage,setSlippage=_useContext2.setSlippage;return{slippage:slippage,setSlippage:setSlippage};}export var sendTransaction=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(connection,wallet,instructions,signers){var _transaction;var awaitConfirmation,transaction,_transaction2,rawTransaction,options,txid,status,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:awaitConfirmation=_args.length>4&&_args[4]!==undefined?_args[4]:true;transaction=new Transaction();instructions.forEach(function(instruction){return transaction.add(instruction);});_context.next=5;return connection.getRecentBlockhash(\"max\");case 5:transaction.recentBlockhash=_context.sent.blockhash;(_transaction=transaction).setSigners.apply(_transaction,[// fee payied by the wallet owner\nwallet.publicKey].concat(_toConsumableArray(signers.map(function(s){return s.publicKey;}))));if(signers.length>0){(_transaction2=transaction).partialSign.apply(_transaction2,_toConsumableArray(signers));}_context.next=10;return wallet.signTransaction(transaction);case 10:transaction=_context.sent;rawTransaction=transaction.serialize();options={skipPreflight:true,commitment:\"singleGossip\"};_context.next=15;return connection.sendRawTransaction(rawTransaction,options);case 15:txid=_context.sent;if(!awaitConfirmation){_context.next=23;break;}_context.next=19;return connection.confirmTransaction(txid,options&&options.commitment);case 19:status=_context.sent.value;if(!status.err){_context.next=23;break;}// TODO: notify\nnotify({message:\"Transaction failed...\",description:\"\".concat(txid),type:\"error\"});throw new Error(\"Raw transaction \".concat(txid,\" failed (\").concat(JSON.stringify(status),\")\"));case 23:return _context.abrupt(\"return\",txid);case 24:case\"end\":return _context.stop();}}},_callee);}));return function sendTransaction(_x,_x2,_x3,_x4){return _ref2.apply(this,arguments);};}();","map":{"version":3,"sources":["/home/fs/srmswap/srmswap/srmswap.github.io/src/utils/connection.tsx"],"names":["useLocalStorageState","Account","clusterApiUrl","Connection","Transaction","React","useContext","useEffect","useMemo","setProgramIds","notify","ENDPOINTS","name","endpoint","DEFAULT","DEFAULT_SLIPPAGE","ConnectionContext","createContext","setEndpoint","slippage","setSlippage","val","connection","sendConnection","env","ConnectionProvider","children","undefined","toString","find","end","id","onAccountChange","publicKey","removeAccountChangeListener","onSlotChange","removeSlotChangeListener","parseFloat","useConnection","useSendConnection","useConnectionConfig","context","useSlippageConfig","sendTransaction","wallet","instructions","signers","awaitConfirmation","transaction","forEach","instruction","add","getRecentBlockhash","recentBlockhash","blockhash","setSigners","map","s","length","partialSign","signTransaction","rawTransaction","serialize","options","skipPreflight","commitment","sendRawTransaction","txid","confirmTransaction","status","value","err","message","description","type","Error","JSON","stringify"],"mappings":"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","sourcesContent":["import { useLocalStorageState } from \"./utils\";\nimport {\n  Account,\n  clusterApiUrl,\n  Connection,\n  Transaction,\n  TransactionInstruction,\n} from \"@solana/web3.js\";\nimport React, { useContext, useEffect, useMemo } from \"react\";\nimport { setProgramIds } from \"./ids\";\nimport { notify } from \"./notifications\";\n\nexport type ENV = \"mainnet-beta\" | \"testnet\" | \"devnet\" | \"localnet\";\n\nexport const ENDPOINTS = [\n  {\n    name: \"mainnet-beta\" as ENV,\n    endpoint: \"https://solana-api.projectserum.com/\",\n  },\n  { name: \"testnet\" as ENV, endpoint: clusterApiUrl(\"testnet\") },\n  { name: \"devnet\" as ENV, endpoint: clusterApiUrl(\"devnet\") },\n  { name: \"localnet\" as ENV, endpoint: \"http://127.0.0.1:8899\" },\n];\n\nconst DEFAULT = ENDPOINTS[0].endpoint;\nconst DEFAULT_SLIPPAGE = 0.25;\n\ninterface ConnectionConfig {\n  connection: Connection;\n  sendConnection: Connection;\n  endpoint: string;\n  slippage: number;\n  setSlippage: (val: number) => void;\n  env: ENV;\n  setEndpoint: (val: string) => void;\n}\n\nconst ConnectionContext = React.createContext<ConnectionConfig>({\n  endpoint: DEFAULT,\n  setEndpoint: () => {},\n  slippage: DEFAULT_SLIPPAGE,\n  setSlippage: (val: number) => {},\n  connection: new Connection(DEFAULT, \"recent\"),\n  sendConnection: new Connection(DEFAULT, \"recent\"),\n  env: ENDPOINTS[0].name,\n});\n\nexport function ConnectionProvider({ children = undefined as any }) {\n  const [endpoint, setEndpoint] = useLocalStorageState(\n    \"connectionEndpts\",\n    ENDPOINTS[0].endpoint\n  );\n\n  const [slippage, setSlippage] = useLocalStorageState(\n    \"slippage\",\n    DEFAULT_SLIPPAGE.toString()\n  );\n\n  const connection = useMemo(() => new Connection(endpoint, \"recent\"), [\n    endpoint,\n  ]);\n  const sendConnection = useMemo(() => new Connection(endpoint, \"recent\"), [\n    endpoint,\n  ]);\n\n  const env =\n    ENDPOINTS.find((end) => end.endpoint === endpoint)?.name ||\n    ENDPOINTS[0].name;\n\n  setProgramIds(env);\n\n  // The websocket library solana/web3.js uses closes its websocket connection when the subscription list\n  // is empty after opening its first time, preventing subsequent subscriptions from receiving responses.\n  // This is a hack to prevent the list from every getting empty\n  useEffect(() => {\n    const id = connection.onAccountChange(new Account().publicKey, () => {});\n    return () => {\n      connection.removeAccountChangeListener(id);\n    };\n  }, [connection]);\n\n  useEffect(() => {\n    const id = connection.onSlotChange(() => null);\n    return () => {\n      connection.removeSlotChangeListener(id);\n    };\n  }, [connection]);\n\n  useEffect(() => {\n    const id = sendConnection.onAccountChange(\n      new Account().publicKey,\n      () => {}\n    );\n    return () => {\n      sendConnection.removeAccountChangeListener(id);\n    };\n  }, [sendConnection]);\n\n  useEffect(() => {\n    const id = sendConnection.onSlotChange(() => null);\n    return () => {\n      sendConnection.removeSlotChangeListener(id);\n    };\n  }, [sendConnection]);\n\n  return (\n    <ConnectionContext.Provider\n      value={{\n        endpoint,\n        setEndpoint,\n        slippage: parseFloat(slippage),\n        setSlippage: (val) => setSlippage(val.toString()),\n        connection,\n        sendConnection,\n        env,\n      }}\n    >\n      {children}\n    </ConnectionContext.Provider>\n  );\n}\n\nexport function useConnection() {\n  return useContext(ConnectionContext).connection as Connection;\n}\n\nexport function useSendConnection() {\n  return useContext(ConnectionContext)?.sendConnection;\n}\n\nexport function useConnectionConfig() {\n  const context = useContext(ConnectionContext);\n  return {\n    endpoint: context.endpoint,\n    setEndpoint: context.setEndpoint,\n    env: context.env,\n  };\n}\n\nexport function useSlippageConfig() {\n  const { slippage, setSlippage } = useContext(ConnectionContext);\n  return { slippage, setSlippage };\n}\n\nexport const sendTransaction = async (\n  connection: any,\n  wallet: any,\n  instructions: TransactionInstruction[],\n  signers: Account[],\n  awaitConfirmation = true\n) => {\n  let transaction = new Transaction();\n  instructions.forEach((instruction) => transaction.add(instruction));\n  transaction.recentBlockhash = (\n    await connection.getRecentBlockhash(\"max\")\n  ).blockhash;\n  transaction.setSigners(\n    // fee payied by the wallet owner\n    wallet.publicKey,\n    ...signers.map((s) => s.publicKey)\n  );\n  if (signers.length > 0) {\n    transaction.partialSign(...signers);\n  }\n  transaction = await wallet.signTransaction(transaction);\n  const rawTransaction = transaction.serialize();\n  let options = {\n    skipPreflight: true,\n    commitment: \"singleGossip\",\n  };\n\n  const txid = await connection.sendRawTransaction(rawTransaction, options);\n\n  if (awaitConfirmation) {\n    const status = (\n      await connection.confirmTransaction(txid, options && options.commitment)\n    ).value;\n\n    if (status.err) {\n      // TODO: notify\n      notify({\n        message: \"Transaction failed...\",\n        description: `${txid}`,\n        type: \"error\",\n      });\n\n      throw new Error(\n        `Raw transaction ${txid} failed (${JSON.stringify(status)})`\n      );\n    }\n  }\n\n  return txid;\n};\n"]},"metadata":{},"sourceType":"module"}